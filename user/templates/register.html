<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <script id="allmobilize" charset="utf-8" src="{% static 'js/allmobilize.min.js' %}"></script>
    <meta charset="UTF-8">
    <title>注册-淘职</title>

    <link rel="stylesheet" href="{% static 'css/agent.css' %}">
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
    <link rel="stylesheet" href="{% static 'css/global.common.css' %}">

    <script type="text/javascript" src="{% static 'js/jquery.1.10.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.lib.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/core.min.js' %}"></script>

</head>
<body id="login_container">
<div class="login_wrapper">
    <div class="login_header">
        <a href=""><img src="{% static '/imgs/logo.png' %}" width="285" height="62" alt="招聘"/></a>
    </div>
    <input type="hidden" id="resubmitToken" value="9b207beb1e014a93bc852b7ba450db27"/>
    <div class="login_box">

        <form id="loginForm" class="form" action="{% url 'register' %}" method="post">
            {% csrf_token %}
            <ul class="register_radio clearfix">
                <li>
                    找工作
                    <input type="radio" value="0" name="type" class="shenchen"/>
                </li>
                <li>
                    招人
                    <input type="radio" value="1" name="type" class="shenchen"/>
                </li>
            </ul>
            <span class="error" style="display:none;" id="beError"></span>
            {% if tips %}
                <div class="tips">{{ tips }}</div>
            {% endif %}
            <input type="text" id="phone" name="phone" tabindex="1" style="width:296px;font-size:16px;"
                   value="{{ username }}" placeholder="请输入常用手机号"/>
            <span class="error" style="display:none;" id="beError"></span>
            <div class="verification">
                <input type="text" id="verificationCode" name="verificationCode" tabindex="2" placeholder="请输入验证码"/>
                <input type="button" value="获取验证码" id="code_button" class="Code"></input>
            </div>
            <div style="clear: both" class="verification2">
                <span class="error" style="display:none;" id="beError"></span>
            </div>


            <label class="fl registerAgree" for="checkbox">
                <input type="checkbox" id="checkbox" name="checkbox" checked class="checkbox valid"/>我已阅读并同意<a
                    href="/user/privacy/" target="_blank">《用户协议》</a>
            </label>
            <button type="botton" class="submitLogin">注 &nbsp; &nbsp; 册</button>

            <input type="hidden" id="callback" name="callback" value=""/>
            <input type="hidden" id="authType" name="authType" value=""/>
            <input type="hidden" id="signature" name="signature" value=""/>
            <input type="hidden" id="timestamp" name="timestamp" value=""/>

        </form>
        <div class="login_right">
            <div>已有帐号</div>
            <a href="/user/login" class="registor_now">直接登录</a>
        </div>

    </div>
</div>

<script>
    $(document).ready(function () {

        $("#code_button").click(function () {
            {#error_mobile = check_mobile();#}
            error_mobile = false;
            if (!error_mobile) {
                RemainTime();
                $.ajax({
                    url: "{% url 'get_verification_code' %}",
                    type: 'post',
                    data: {
                        phone :$('#phone').val()
                    },
                    success: function (result) {
                        var data = JSON.parse(result);
                        alert(data)
                    }
                });
            }
        });

        $('.submitLogin').click(
            function () {
                var radio = $('input:radio[name="type"]:checked').val();
                var phone = $('#phone').val();
                var code = $('#verificationCode').val();
                if (!radio) {
                    $('.register_radio').next().html('请选择目的');
                    $('.register_radio').next().show();

                }
                if (!phone) {
                    $('#phone').next().html('请输入电话号码');
                    $('#phone').next().show()

                }

                error_mobile = check_mobile()
                if (!code) {
                    $('.verification2').children('span').html('请输入验证码');
                    $('.verification2').children('span').show()

                }
                if (!radio | !phone | !code | error_mobile) {
                    return false;
                }
            }
        );

        $('.register_radio li input').click(function (e) {
            $(this).parent('li').addClass('current').append('<em></em>').siblings().removeClass('current').find('em').remove();
        });

    });


    var iTime = 60;
    sTime = '';

    function RemainTime() {
        if (iTime == 0) {
            document.getElementById('code_button').disabled = false;
            sTime = "获取验证码";
            iTime = 60;
            document.getElementById('code_button').value = sTime;
            return;
        } else {
            document.getElementById('code_button').disabled = true;
            sTime = "重新发送(" + iTime + ")";
            iTime--;
        }
        setTimeout(function () {
            RemainTime()
        }, 1000)
        document.getElementById('code_button').value = sTime;
    }

    function check_mobile() {

        var re = /^1[345678]\d{9}$/; //校验手机号

        if (re.test($('#phone').val())) {
            $('#phone').next().hide();
            error_mobile = false;
        }
        else {
            $('#phone').next().html('你输入的手机格式不正确');
            $('#phone').next().show();
            error_mobile = true;
        }
        return error_mobile
    }


</script>

</body>
</html>